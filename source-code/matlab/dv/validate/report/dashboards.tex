% Data generated by dv_generate_reports:generate_dashboards.
% 
% Copyright 2017 United States Government as represented by the
% Administrator of the National Aeronautics and Space Administration.
% All Rights Reserved.
% 
% NASA acknowledges the SETI Institute's primary role in authoring and
% producing the Kepler Data Processing Pipeline under Cooperative
% Agreement Nos. NNA04CC63A, NNX07AD96A, NNX07AD98A, NNX11AI13A,
% NNX11AI14A, NNX13AD01A & NNX13AD16A.
% 
% This file is available under the terms of the NASA Open Source Agreement
% (NOSA). You should have received a copy of this agreement with the
% Kepler source code; see the file NASA-OPEN-SOURCE-AGREEMENT.doc.
% 
% No Warranty: THE SUBJECT SOFTWARE IS PROVIDED "AS IS" WITHOUT ANY
% WARRANTY OF ANY KIND, EITHER EXPRESSED, IMPLIED, OR STATUTORY,
% INCLUDING, BUT NOT LIMITED TO, ANY WARRANTY THAT THE SUBJECT SOFTWARE
% WILL CONFORM TO SPECIFICATIONS, ANY IMPLIED WARRANTIES OF
% MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR FREEDOM FROM
% INFRINGEMENT, ANY WARRANTY THAT THE SUBJECT SOFTWARE WILL BE ERROR
% FREE, OR ANY WARRANTY THAT DOCUMENTATION, IF PROVIDED, WILL CONFORM
% TO THE SUBJECT SOFTWARE. THIS AGREEMENT DOES NOT, IN ANY MANNER,
% CONSTITUTE AN ENDORSEMENT BY GOVERNMENT AGENCY OR ANY PRIOR RECIPIENT
% OF ANY RESULTS, RESULTING DESIGNS, HARDWARE, SOFTWARE PRODUCTS OR ANY
% OTHER APPLICATIONS RESULTING FROM USE OF THE SUBJECT SOFTWARE.
% FURTHER, GOVERNMENT AGENCY DISCLAIMS ALL WARRANTIES AND LIABILITIES
% REGARDING THIRD-PARTY SOFTWARE, IF PRESENT IN THE ORIGINAL SOFTWARE,
% AND DISTRIBUTES IT "AS IS."
% 
% Waiver and Indemnity: RECIPIENT AGREES TO WAIVE ANY AND ALL CLAIMS
% AGAINST THE UNITED STATES GOVERNMENT, ITS CONTRACTORS AND
% SUBCONTRACTORS, AS WELL AS ANY PRIOR RECIPIENT. IF RECIPIENT'S USE OF
% THE SUBJECT SOFTWARE RESULTS IN ANY LIABILITIES, DEMANDS, DAMAGES,
% EXPENSES OR LOSSES ARISING FROM SUCH USE, INCLUDING ANY DAMAGES FROM
% PRODUCTS BASED ON, OR RESULTING FROM, RECIPIENT'S USE OF THE SUBJECT
% SOFTWARE, RECIPIENT SHALL INDEMNIFY AND HOLD HARMLESS THE UNITED
% STATES GOVERNMENT, ITS CONTRACTORS AND SUBCONTRACTORS, AS WELL AS ANY
% PRIOR RECIPIENT, TO THE EXTENT PERMITTED BY LAW. RECIPIENT'S SOLE
% REMEDY FOR ANY SUCH MATTER SHALL BE THE IMMEDIATE, UNILATERAL
% TERMINATION OF THIS AGREEMENT.
%

\section{Dashboards}

% \dbvalue{variablePrefix}{textPrefix}{textSuffix}
%
% Displays a value with the given variablePrefix with \thislevelitem
% as a suffix. The uncertainty, which is defined as the variablePrefix
% + ``Uncertainty'' + \thislevelitem, is displayed following a +/-
% symbol if it exists. The value and uncertainty are preceeded with
% the textPrefix and followed with a textSuffix. The textPrefix is
% followed by a space, while the textSuffix is not preceeded by a
% space in order to append characters after the value (for example,
% 42%). If the value does not exist, then N/A is displayed after textPrefix.
%
% For example, 
% \dbvalue{bootstrapFalseAlarm}{False Alarm =}{}
% -> False Alarm = N/A
% \dbvalue{snr}{SNR =}{}
% -> SNR = 51.5
% \dbvalue{starRadiusSolarRadii}{}{ Solar units}
% -> 1.1 ± 0.0 Solar units
% \dbvalue{orbitalPeriodDays}{Period =}{ days}
% -> Period = 32.0 ± 0.0 days
% \dbvalue{centroidTestSignificance}{Significance =}{\%}
% -> Significance = 3.97%
\newcommand{\dbvalue}[3]{%
  #2 
  \ifcsname #1\thislevelitem\endcsname
  \ifcsname #1Uncertainty\thislevelitem\endcsname
  \csname #1\thislevelitem\endcsname{}
  $\pm$ \csname #1Uncertainty\thislevelitem\endcsname%
  \else
  \csname #1\thislevelitem\endcsname{}%
  \fi
  #3
  \else
  $N/A$%
  \fi
}%

\newcommand{\dbovalue}[3]{%
  #2 
  \ifcsname #1Dbo\thislevelitem\endcsname
  \ifcsname #1Uncertainty\thislevelitem\endcsname
  \csname #1Dbo\thislevelitem\endcsname{}
  $\pm$ \csname #1Uncertainty\thislevelitem\endcsname%
  \else
  \csname #1Dbo\thislevelitem\endcsname{}%
  \fi
  #3
  \else
  $N/A$%
  \fi
}%

\newlength{\blockTitleWidth}
\setlength{\blockTitleWidth}{1.25cm}

% 50% is too dark. It evoked comments of ``lighten and decrease
% saturation'' from Steve Bryson.
\newcommand{\darkness}{20}
\newcommand{\rulelightness}{80} % makes multirow hhlines blend in
\newcommand{\margin}{0.20cm}

% Plots for different planet candidates are separated by a
% comma.
\ForEachX
    {,}
    {%
      \fancyhead[R]{Target \keplerId{} / Planet Candidate \csname
        planet\thislevelitem \endcsname}
      \begin{table}[htb!]
        \begin{tabularx}{\tablewidth}{| m{\blockTitleWidth} | >{\hsize=0.5\hsize}X | >{\hsize=0.5\hsize}X | X | m{\blockTitleWidth} |}
% row 0
          \multicolumn{5}{c}{%
            \textbf{\Large Planet Candidate \csname
              planet\thislevelitem \endcsname}\newline
            \vspace{\margin}
          }\\
% row 1
          \hline
          \multirow{2}{*}[-.75cm]{%
            \begin{minipage}{\blockTitleWidth}
              \centering\rotatebox{90}{\bfseries Model Fitter\ \ }
            \end{minipage}
          }%
          &
          \multicolumn{2}{l|}{%
          \begin{minipage}{0.4\hsize}
            \vspace{\margin}
            \textbf{Stellar Radius} \\
            \dbvalue{starRadiusSolarRadii}{}{ Solar units}
            \vspace{\margin}
          \end{minipage}
          \cellcolor{\csname starRadiusColor\thislevelitem
            \endcsname!\darkness!white}
          }%
          & 
          \cellcolor{\csname centroidTestColor\thislevelitem
            \endcsname!\darkness!white}
          & 
          \multirow{2}{*}[-0.5cm]{%
            \begin{minipage}{\blockTitleWidth}
              \centering\rotatebox{-90}{\bfseries \ \ Centroid Test}
            \end{minipage}
          }\\
% row 2
          \hhline{~--%
            >{\arrayrulecolor{\csname centroidTestColor\thislevelitem
                \endcsname!\rulelightness!white}}%
            -~%
            >{\arrayrulecolor{black}}}%
          &
          \multicolumn{2}{l|}{%
            \begin{minipage}{0.4\hsize}
              \vspace{\margin}
              \dbvalue{orbitalPeriodDays}{Period =}{ days}~\\
              \dbvalue{transitDepthPpm}{Depth =}{ ppm}~\\
              \dbvalue{planetRadiusEarthRadii}{Planet Radius =}{ Earth radii}~\\
              \dbvalue{semiMajorAxisAu}{Semi-major Axis =}{ AU}~\\
              \dbvalue{effectiveStellarFlux}{Effective Stellar Flux =}{}~\\
              \dbvalue{equilibriumTempKelvin}{Equilibrium Temperature =}{ Kelvin}~\\
              \dbvalue{chiSquaredOverDof}{Chi-squared/DoF =}{}~\\
              \dbvalue{snr}{SNR =}{}~\\
              \vfill
              \textcolor{\csname modelFitResultColor\thislevelitem\endcsname}{%
                \csname modelFitResult\thislevelitem\endcsname{}
              }%
              \vspace{\margin}
            \end{minipage}
            \cellcolor{\csname modelFitColor\thislevelitem
              \endcsname!\darkness!white}
          }%
          & 
          \multirow{-2}{\hsize}{%
            % TODO Replace this with a construct to vertically align
            % the text at the top of the cell.
            \vspace{-2.65cm}\\
            \textbf{Flux Weighted Motion Detection Statistic}\\[2ex]
            \dbvalue{centroidTestValue}{Value =}{}~\\
            \dbvalue{centroidTestSignificance}{Significance =}{\%}~\\
            \dbvalue{peakRaOffset}{Peak RA Offset}
                    { arcsec (\csname peakRaOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbvalue{peakDecOffset}{Peak Dec Offset =}
                    { arcsec (\csname peakDecOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbvalue{peakOffset}{Peak Offset Distance =}
                    { arcsec (\csname peakOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbvalue{sourceRaOffset}{Source RA Offset =}
                    { arcsec (\csname sourceRaOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbvalue{sourceDecOffset}{Source Dec Offset =}
                    { arcsec (\csname sourceDecOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbvalue{sourceOffset}{Source Offset Distance =}
                    { arcsec (\csname sourceOffsetError\thislevelitem\endcsname{} $\sigma$)}~\\
          }%
          \cellcolor{\csname centroidTestColor\thislevelitem
            \endcsname!\darkness!white}
          & \\
% row 3
          \hline
          \multirow{2}{*}[0.3cm]{%
            \begin{minipage}{\blockTitleWidth}
              \centering\rotatebox{90}{%
                \begin{minipage}{3.5cm}
                  \textbf{Eclipsing Binary \newline Discrimination Test}
                \end{minipage}
              }%
            \end{minipage}
          }%
          &
          \begin{minipage}{\hsize}
            \vspace{\margin}
            \textbf{Odd-Even Depth \\ Comparison Statistic} \\[1ex]
            \dbvalue{oddEvenDepth}{Value =}{}~\\
            \dbvalue{oddEvenDepthSignificance}{Significance =}{\%}~\\
            \vspace{\margin}
          \end{minipage}
          \cellcolor{\csname oddEvenDepthColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \begin{minipage}{\hsize}
            \vspace{\margin}
            \textbf{Odd-Even Epoch \\ Comparison Statistic} \\[1ex]
            \dbvalue{oddEvenEpoch}{Value =}{}~\\
            \dbvalue{oddEvenEpochSignificance}{Significance =}{\%}~\\
            \vspace{\margin}
          \end{minipage}
          \cellcolor{\csname oddEvenEpochColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \begin{minipage}{\hsize}
            \textbf{Offsets Relative to Out of Transit Centroid} \\[1ex]
            \dbovalue{diffImageMqCntlCentroidOffsetsMeanRa}{Source RA Offset =}
                    { arcsec (\csname diffImageMqCntlCentroidOffsetsMeanRaSigma\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbovalue{diffImageMqCntlCentroidOffsetsMeanDec}{Source Dec Offset =}
                    { arcsec (\csname diffImageMqCntlCentroidOffsetsMeanDecSigma\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbovalue{diffImageMqCntlCentroidOffsetsMeanDistanceSky}{Source Offset Distance =}
                    { arcsec (\csname diffImageMqCntlCentroidOffsetsMeanDistanceSkySigma\thislevelitem\endcsname{} $\sigma$)}~\\
          \end{minipage}
          \begin{minipage}{\hsize}
            \textbf{Offsets Relative to KIC Position} \\[1ex]
            \dbovalue{diffImageMqKicCentroidOffsetsMeanRa}{Source RA Offset =}
                    { arcsec (\csname diffImageMqKicCentroidOffsetsMeanRaSigma\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbovalue{diffImageMqKicCentroidOffsetsMeanDec}{Source Dec Offset =}
                    { arcsec (\csname diffImageMqKicCentroidOffsetsMeanDecSigma\thislevelitem\endcsname{} $\sigma$)}~\\
            \dbovalue{diffImageMqKicCentroidOffsetsMeanDistanceSky}{Source Offset Distance =}
                    { arcsec (\csname diffImageMqKicCentroidOffsetsMeanDistanceSkySigma\thislevelitem\endcsname{} $\sigma$)}~\\
          \end{minipage}
          \cellcolor{\csname differenceImageCentroidOffsetsColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \multirow{1}{*}[0.6cm]{%
            \begin{minipage}{\blockTitleWidth}
              \centering\rotatebox{-90}{%
                \begin{minipage}{3.5cm}
                  \textbf{Difference Image \newline Centroid Offsets}
                \end{minipage}
              }%
            \end{minipage}
          } \\
% row 4
          \hhline{~----}
          &
          \begin{minipage}{\hsize}
            \vspace{\margin}
            \textbf{Shorter Period \\ Comparison Statistic} \\[1ex]
            \dbvalue{shorterPeriod}{Value =}{}~\\
            \dbvalue{shorterPeriodSignificance}{Significance =}{\%}~\\
            \vspace{\margin}
          \end{minipage} 
          \cellcolor{\csname shorterPeriodColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \begin{minipage}{\hsize}
            % Why is the vspace and the (missing) trailing newline on
            % longerPeriodSignificance needed to get the same
            % alignment?
            \vspace{-0.1cm}
            \textbf{Longer Period \\ Comparison Statistic} \\[1ex]
            \dbvalue{longerPeriod}{Value =}{}~\\
            \dbvalue{longerPeriodSignificance}{Significance =}{\%}
            \vspace{\margin}
          \end{minipage}
          \cellcolor{\csname longerPeriodColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \multirow{1}{\hsize}{%
            % TODO Replace this with a construct to vertically align
            % the text at the top of the cell.
            \vspace{-1.1cm}\\
            \dbvalue{bootstrapFalseAlarm}{False Alarm =}{}~\\
            \dbvalue{finalSkipCount}{Final Skip Count =}{}~\\
            \dbvalue{observedTransitCount}{Observed Number of Transits =}{}~\\
            Max Multiple Event Statistic = \csname maxMultipleEventStatistic\thislevelitem\endcsname{}\\
          }%
          \cellcolor{\csname bootstrapColor\thislevelitem
            \endcsname!\darkness!white}
          &
          \multirow{1}{*}[0.6cm]{%
            \begin{minipage}{\blockTitleWidth}
              \centering\rotatebox{-90}{%
                \begin{minipage}{3.5cm}
                  \textbf{Bootstrap \newline Test}
                \end{minipage}
              }%
            \end{minipage}
          } \\
% row 5
          \hline
          % The use of coloring cells in this fashion is a great debugging
          % technique to ensure that all of the extra spaces are removed
          % with trailing percent signs (%). Comment out the rest of this
          % function to complete the effect.
          % \cellcolor{red!50!white}foo & \cellcolor{blue!50!white}bar\\
        \end{tabularx}\\
        \vspace{.25cm}

        Summary of model fitter results and validation test results
        for target \keplerId, planet candidate \csname
        planet\thislevelitem \endcsname.
        %
        In general, green denotes that the candidate is likely a
        planet, while red denotes that the candidate is unlikely to be
        a planet. Cyan denotes that no data is available.
        %
        The color of the Model Fitter block is: green, when the SNR of
        the fit is greater than or equal to 10; yellow, if the SNR is
        greater than or equal to {\searchTransitThreshold} but less than
        10; red, if the SNR is less than {\searchTransitThreshold} or
        if the fitter failed.
        %
        The color of the Centroid Test and Eclipsing Binary
        Discrimination Test blocks are: green, when the significance
        is within 2-sigma; yellow, when the significance is between 2-
        and 3-sigma; red when the significance is greater than
        3-sigma.
        %
        The color of the Difference Image Centroid Offsets block is:
        green, when the max offset distance sigma is less than or equal
        to 2; yellow, when the max sigma is between 2 and 3; red when
        the max sigma is greater than 3.
        %
        The color of the Bootstrap Test block is green whenever the
        false alarm probability is less than \e{-12}, low enough to
        limit the total number of false alarms from a four year mission
        to less than one. If the false alarm probability is greater
        than \e{-12}, the color of the Bootstrap Test block is: green,
        when the false alarm probability is less than or equal to the
        CCDF of a Gaussian distribution at the observed maximum multiple
        event statistic; yellow when the false alarm probability is
        between 1 and 2 times that of a Gaussian distribution at the max
        multiple event statistic; and red when the false alarm
        probability is more than 2 times that of a Gaussian distribution
        at the max multiple event statistic.
      \end{table}
      \clearpage
    }
    {\planets}
